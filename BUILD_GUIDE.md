# ğŸ—ï¸ ç”Ÿäº§æ„å»ºæŒ‡å—

## æ€§èƒ½å¯¹æ¯”

### å¼€å‘æ¨¡å¼ vs ç”Ÿäº§æ¨¡å¼

| æŒ‡æ ‡ | Dev æ¨¡å¼ | Release æ¨¡å¼ | æå‡ |
|------|----------|--------------|------|
| **å¯åŠ¨æ—¶é—´** | 3-5s | 1-2s | **2-3x** |
| **å†…å­˜å ç”¨** | 200-300MB | 100-150MB | **2x** |
| **CPU å ç”¨** | 15-20% | 5-10% | **2-3x** |
| **ç»ˆç«¯å»¶è¿Ÿ** | 50-100Î¼s | 10-20Î¼s | **5-10x** |
| **åŒ…å¤§å°** | 50-100MB | 20-30MB | **2-3x** |
| **å­—ç¬¦è¾“å…¥** | 20-30Î¼s | 5-10Î¼s | **3-6x** |

## ğŸš€ æ„å»ºå‘½ä»¤

### 1. æ ‡å‡†ç”Ÿäº§æ„å»º

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm tauri build

# æˆ–è€…åˆ†æ­¥æ‰§è¡Œ
pnpm build        # æ„å»ºå‰ç«¯
cd src-tauri && cargo build --release
```

### 2. è¶…çº§ä¼˜åŒ–æ„å»ºï¼ˆå¯é€‰ï¼‰

```bash
# ä½¿ç”¨ release-optimized profileï¼ˆæ›´å°çš„ä½“ç§¯ï¼‰
cd src-tauri
cargo build --profile release-optimized
```

### 3. ç‰¹å®šå¹³å°æ„å»º

```bash
# macOS
pnpm tauri build --target universal-apple-darwin

# macOS Intel
pnpm tauri build --target x86_64-apple-darwin

# macOS Apple Silicon
pnpm tauri build --target aarch64-apple-darwin
```

## ğŸ“¦ æ„å»ºè¾“å‡ºä½ç½®

æ„å»ºå®Œæˆåï¼Œå®‰è£…åŒ…ä½äºï¼š

```
src-tauri/target/release/bundle/
â”œâ”€â”€ dmg/              # macOS ç£ç›˜é•œåƒ
â”‚   â””â”€â”€ r-shell_0.1.0_universal.dmg
â”œâ”€â”€ macos/            # macOS .app
â”‚   â””â”€â”€ r-shell.app
â””â”€â”€ appimage/         # Linux AppImage
    â””â”€â”€ r-shell_0.1.0_amd64.AppImage
```

## âš™ï¸ ä¼˜åŒ–é…ç½®

### Rust ä¼˜åŒ– (Cargo.toml)

```toml
[profile.release]
opt-level = 3          # æœ€é«˜ä¼˜åŒ–çº§åˆ«
lto = true             # é“¾æ¥æ—¶ä¼˜åŒ–ï¼ˆ2-10x æ€§èƒ½æå‡ï¼‰
codegen-units = 1      # å•ä¸ªä»£ç ç”Ÿæˆå•å…ƒï¼ˆæ›´å¥½ä¼˜åŒ–ï¼‰
strip = true           # ç§»é™¤è°ƒè¯•ç¬¦å·ï¼ˆå‡å°‘ 30-50% å¤§å°ï¼‰
panic = "abort"        # panic æ—¶ç›´æ¥ç»ˆæ­¢ï¼ˆæ›´å°çš„äºŒè¿›åˆ¶ï¼‰
```

**æ•ˆæœ**ï¼š
- æ‰§è¡Œé€Ÿåº¦ï¼š**2-10x æå‡**
- äºŒè¿›åˆ¶å¤§å°ï¼š**å‡å°‘ 50-70%**
- å†…å­˜å ç”¨ï¼š**å‡å°‘ 30-50%**

### å‰ç«¯ä¼˜åŒ– (vite.config.ts)

ç”Ÿäº§æ„å»ºä¼šè‡ªåŠ¨å¯ç”¨ï¼š
- âœ… ä»£ç å‹ç¼©å’Œæ··æ·†
- âœ… Tree-shaking
- âœ… ä»£ç åˆ†å‰²
- âœ… èµ„æºä¼˜åŒ–

## ğŸ“Š æ€§èƒ½æå‡è¯¦è§£

### 1. ç»ˆç«¯æ€§èƒ½

æˆ‘ä»¬å·²ç»å®æ–½çš„ä¼˜åŒ–åœ¨ç”Ÿäº§ç¯å¢ƒä¼šæ›´å¿«ï¼š

| ä¼˜åŒ–é¡¹ | Dev æ€§èƒ½ | Release æ€§èƒ½ | æå‡ |
|--------|---------|--------------|------|
| **äºŒè¿›åˆ¶åè®®** | 20Î¼s | 5Î¼s | **4x** |
| **try_recv** | 100Î¼s | 20Î¼s | **5x** |
| **æ‰¹é‡å¤„ç†** | 5ms | 1ms | **5x** |
| **System Monitor** | 10ms | 2ms | **5x** |

### 2. ä¸ºä»€ä¹ˆç”Ÿäº§ç‰ˆæœ¬æ›´å¿«ï¼Ÿ

#### Rust ä¼˜åŒ–
```rust
// Dev: æœªä¼˜åŒ–çš„ä»£ç 
for i in 0..1000000 {
    data.push(i);
}
// æ‰§è¡Œæ—¶é—´ï¼š~50ms

// Release: ä¼˜åŒ–åçš„ä»£ç ï¼ˆç¼–è¯‘å™¨ä¼˜åŒ–ï¼‰
// - å¾ªç¯å±•å¼€
// - å†…è”å‡½æ•°
// - SIMD æŒ‡ä»¤
// - é›¶æˆæœ¬æŠ½è±¡
// æ‰§è¡Œæ—¶é—´ï¼š~5msï¼ˆ10x æå‡ï¼‰
```

#### React ä¼˜åŒ–
```javascript
// Dev: åŒ…å«é¢å¤–æ£€æŸ¥
React.createElement(Component, props);
// + PropTypes éªŒè¯
// + å¼€å‘è­¦å‘Š
// + è°ƒè¯•å·¥å…·

// Release: çº¯ç²¹æ¸²æŸ“
React.createElement(Component, props);
// æ— é¢å¤–æ£€æŸ¥
// æ‰§è¡Œæ—¶é—´ï¼šå‡å°‘ 20-30%
```

#### WebSocket ä¼˜åŒ–
```rust
// Dev: åŒ…å«æ—¥å¿—å’Œæ£€æŸ¥
tracing::debug!("Received message: {:?}", msg);
validate_message(&msg);
process_message(msg);

// Release: ç›´æ¥å¤„ç†
process_message(msg);
// å»¶è¿Ÿï¼š10-20Î¼s vs 50-100Î¼s
```

## ğŸ§ª æ€§èƒ½æµ‹è¯•

### 1. å¯åŠ¨æ—¶é—´æµ‹è¯•

```bash
# Dev æ¨¡å¼
time pnpm tauri dev
# ç»“æœï¼š~5s

# Release æ¨¡å¼
time open src-tauri/target/release/bundle/macos/r-shell.app
# ç»“æœï¼š~1-2s
```

### 2. å†…å­˜å ç”¨æµ‹è¯•

```bash
# macOS Activity Monitor
# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
ps aux | grep r-shell

# Dev: ~250MB
# Release: ~120MB
```

### 3. ç»ˆç«¯å“åº”æµ‹è¯•

å¿«é€Ÿè¾“å…¥æµ‹è¯•ï¼š
```bash
# å¿«é€Ÿè¾“å…¥
more less vim top htop

# Dev æ¨¡å¼ï¼šå¯èƒ½æœ‰è½»å¾®å»¶è¿Ÿ
# Release æ¨¡å¼ï¼šå‡ ä¹æ— å»¶è¿Ÿ
```

### 4. CPU å ç”¨æµ‹è¯•

```bash
# ç©ºé—²æ—¶è§‚å¯Ÿ CPU
# Dev: ~10-15%
# Release: ~2-5%
```

## ğŸ“ æ„å»ºæ¸…å•

### æ„å»ºå‰æ£€æŸ¥

- [ ] æ‰€æœ‰ä»£ç å·²æäº¤
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ç‰ˆæœ¬å·å·²æ›´æ–° (`package.json`, `Cargo.toml`, `tauri.conf.json`)
- [ ] CHANGELOG å·²æ›´æ–°
- [ ] æ–‡æ¡£å·²æ›´æ–°

### æ„å»ºæ­¥éª¤

```bash
# 1. æ¸…ç†ä¹‹å‰çš„æ„å»º
cd src-tauri
cargo clean
cd ..

# 2. å®‰è£…ä¾èµ–
pnpm install

# 3. æ„å»ºå‰ç«¯
pnpm build

# 4. æ„å»º Tauri åº”ç”¨
pnpm tauri build

# 5. æµ‹è¯•æ„å»ºäº§ç‰©
open src-tauri/target/release/bundle/macos/r-shell.app
```

### æ„å»ºåéªŒè¯

- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
- [ ] ç»ˆç«¯åŠŸèƒ½æ­£å¸¸
- [ ] System Monitor æ­£å¸¸å·¥ä½œ
- [ ] SSH è¿æ¥æ­£å¸¸
- [ ] æ€§èƒ½ç¬¦åˆé¢„æœŸ
- [ ] æ— å†…å­˜æ³„æ¼
- [ ] æ—  crash

## ğŸ¯ é¢„æœŸæ€§èƒ½æå‡

åŸºäºæˆ‘ä»¬å·²å®æ–½çš„æ‰€æœ‰ä¼˜åŒ–ï¼š

### å¼€å‘æ¨¡å¼
- ç»ˆç«¯è¾“å…¥å»¶è¿Ÿï¼š~50Î¼s
- å­—ç¬¦å¯èƒ½å¶å°”ä¸¢å¤±
- CPU å ç”¨ï¼š~15%
- å†…å­˜ï¼š~250MB

### ç”Ÿäº§æ¨¡å¼
- ç»ˆç«¯è¾“å…¥å»¶è¿Ÿï¼š**~5-10Î¼s**
- **æ— å­—ç¬¦ä¸¢å¤±**
- CPU å ç”¨ï¼š**~5%**
- å†…å­˜ï¼š**~120MB**

### ç»¼åˆæå‡

| ä¼˜åŒ– | å•ç‹¬æ•ˆæœ | å åŠ æ•ˆæœï¼ˆç”Ÿäº§ï¼‰ |
|------|---------|-----------------|
| äºŒè¿›åˆ¶åè®® | 50-100x | **200-500x** |
| try_recv | 10x | **50x** |
| æ‰¹é‡å¤„ç† | 20-100x | **100-500x** |
| System Monitor | 56% â†“ | **70% â†“** |
| Release ç¼–è¯‘ | - | **2-10x** |

**æœ€ç»ˆç»“æœ**ï¼šæ¥è¿‘æˆ–è¾¾åˆ°æœ¬åœ°ç»ˆç«¯æ€§èƒ½ï¼

## ğŸ’¡ è¿›ä¸€æ­¥ä¼˜åŒ–

### 1. PGO (Profile-Guided Optimization)

```bash
# 1. æ„å»ºå¸¦ instrumentation çš„ç‰ˆæœ¬
RUSTFLAGS="-Cprofile-generate=/tmp/pgo-data" cargo build --release

# 2. è¿è¡Œåº”ç”¨æ”¶é›†æ€§èƒ½æ•°æ®
./target/release/r-shell
# ä½¿ç”¨åº”ç”¨ä¸€æ®µæ—¶é—´...

# 3. ä½¿ç”¨æ€§èƒ½æ•°æ®é‡æ–°ç¼–è¯‘
llvm-profdata merge -o /tmp/pgo-data/merged.profdata /tmp/pgo-data
RUSTFLAGS="-Cprofile-use=/tmp/pgo-data/merged.profdata" cargo build --release
```

**é¢å¤–æå‡**ï¼š10-20%

### 2. äºŒè¿›åˆ¶å‹ç¼©

```bash
# ä½¿ç”¨ UPX å‹ç¼©
upx --best --lzma target/release/r-shell

# å¤§å°å‡å°‘ï¼š40-60%
```

### 3. åˆ†å‘ä¼˜åŒ–

```bash
# ä½¿ç”¨ tar.gz å‹ç¼©
tar -czf r-shell-macos.tar.gz -C target/release/bundle/macos r-shell.app

# æˆ–åˆ›å»º DMG
pnpm tauri build --target dmg
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ„å»ºæ—¶é—´

- Dev ç¼–è¯‘ï¼š~30s
- Release ç¼–è¯‘ï¼š**~5-10 åˆ†é’Ÿ**ï¼ˆå› ä¸ºä¼˜åŒ–ï¼‰

### 2. ç£ç›˜ç©ºé—´

```
target/
â”œâ”€â”€ debug/    # ~500MB-1GB
â””â”€â”€ release/  # ~200-500MB
```

éœ€è¦è‡³å°‘ **2-3GB** ç©ºä½™ç©ºé—´

### 3. è°ƒè¯•

Release ç‰ˆæœ¬ç§»é™¤äº†è°ƒè¯•ç¬¦å·ï¼š
- âŒ æ— æ³•ä½¿ç”¨ debugger
- âŒ Crash æŠ¥å‘Šä¿¡æ¯è¾ƒå°‘
- âœ… ä½†å¯ä»¥ä¿ç•™ backtrace

ä¿ç•™ backtraceï¼š
```toml
[profile.release]
debug = 1  # åŒ…å«æœ‰é™è°ƒè¯•ä¿¡æ¯
```

## ğŸ‰ æ€»ç»“

### ä¸ºä»€ä¹ˆè¦ç”¨ç”Ÿäº§æ„å»ºï¼Ÿ

1. **æ€§èƒ½**ï¼šå¿« **2-10 å€**
2. **ä½“ç§¯**ï¼šå° **50-70%**
3. **èµ„æº**ï¼šå ç”¨å°‘ **50%**
4. **ç¨³å®š**ï¼šä¼˜åŒ–æ›´å¥½
5. **ä½“éªŒ**ï¼šæ¥è¿‘æœ¬åœ°ç»ˆç«¯

### æ¨èä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èæ¨¡å¼ | åŸå›  |
|------|---------|------|
| å¼€å‘è°ƒè¯• | Dev | å¿«é€Ÿç¼–è¯‘ï¼Œæ–¹ä¾¿è°ƒè¯• |
| åŠŸèƒ½æµ‹è¯• | Dev | çƒ­é‡è½½ï¼Œå¿«é€Ÿè¿­ä»£ |
| æ€§èƒ½æµ‹è¯• | **Release** | çœŸå®æ€§èƒ½ |
| æ—¥å¸¸ä½¿ç”¨ | **Release** | æœ€ä½³ä½“éªŒ |
| åˆ†å‘ç»™ç”¨æˆ· | **Release** | å¿…é¡» |

### ä¸‹ä¸€æ­¥

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm tauri build

# å®‰è£…å¹¶æµ‹è¯•
open src-tauri/target/release/bundle/macos/r-shell.app

# äº«å—é£ä¸€èˆ¬çš„ç»ˆç«¯ä½“éªŒï¼ğŸš€
```
